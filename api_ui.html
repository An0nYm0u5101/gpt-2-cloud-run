<!DOCTYPE html>

<style>
html, body {
            height: 95% !important;
            margin: 0 !important;
        }

footer {
    /*max-height: 5% !important;*/
    padding: 1em !important
}

section {
	    min-height: 95% !important
	}

.gen-box {
    background-color: #fff;
    display: block;
    padding: 1.25rem;
    color: #4a4a4a;
    border-bottom: 0.5px solid #d5d5d5;
    font-size: 1.25rem;
    font-weight: 400;
    line-height: 1.25;
}

.gen-box.warning {
    color: red;
    font-weight: 700;

}

#extra-buttons {
  padding-top: 1em;
  margin-top: 1em;
  border-top: 0.5px solid #d5d5d5;
}
</style>

<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>
<nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="https://bulma.io">
            <img src="https://bulma.io/images/bulma-logo.png" width="112" height="28">
        </a>
    </div>

    <div id="navbarBasicExample" class="navbar-menu is-active">
        <div class="navbar-start">


            <div class="navbar-item">
                Generate custom text from an AI using GPT-2 (using the 117M default model)
            </div>

        </div>

        <div class="navbar-end">
            <div class="navbar-item is-hidden-touch">
                <div class="buttons">
                    <a class="button is-light">
                            <span class="icon">
                                    <i class="fab fa-lg fa-github"></i>
                                  </span><span>GitHub</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<body>
    <section id="main" class="section">
        <div class="container">
            <div class="columns is-variable is-8">
                <div  class="column is-narrow" style="width: 250px;">
                        <form id="gen-form">
                        <div class="field">
                                <label class="label">Text Prompt</label>
                                <div class="control">
                                  <textarea id="prefix" class="textarea" type="text" placeholder="ROMEO:" rows="2"></textarea>
                                </div>
                                <p class="help">Starts the generated text with the specified text. <em>(if empty, will use a random starting text)</em></p>
                              </div>
                        <div class="field">
                                <label class="label">Generated Text Length</label>
                                <div class="control">
                                  <input id="gen-length" class="input" type="text" placeholder="Text input" value="100">
                                </div>
                                <p class="help">Length of the text in tokens to generate. <em>(max: 1024)</em></p>
                              </div>

                              <div class="field">
                                    <label class="label">Temperature</label>
                                    <div class="control">
                                      <input id="temperature" class="input" type="text" placeholder="0.7" value="0.7">
                                    </div>
                                    <p class="help">Controls the generated text "creativity." <em>(the higher the temperature, the more creative)</em></p>
                                  </div>
                                  <div class="buttons">
                              <span class="control">
                                    <button type="submit" name="submit" id="generate-text" class="button is-link" >
                                            <span class="icon">
                                                    <i class="fas fa-md fa-robot"></i>
                                                  </span><span>Generate Text!</span></button>
                                    </span>

                                      </div>
                                      </form>
                                      <div id="extra-buttons" class="buttons">
                                      <span class="control">
                                        <button id="clear-text" class="button is-danger">
                                                Clear Texts</button>
                                        </span>
                                      </div>
                </div>
                <div id="model-output" class="column">
                    <p id="tutorial" class="subtitle"><em>Generated text will appear here!
                        Use the form to configure GPT-2 and press <strong>Generate Text</strong>
                        to get your own text!
                    </em></p>
                </div>
            </div>
        </div>

    
    </section>

    <footer class="footer">
            <div class="content has-text-centered">
              <p>
                <strong>Bulma</strong> by <a href="https://jgthms.com">Jeremy Thomas</a>. The source code is licensed
                <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. The website content
                is licensed <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY NC SA 4.0</a>.
              </p>
            </div>
          </footer>


</body>

<script
src="https://code.jquery.com/jquery-3.4.1.min.js"
integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
crossorigin="anonymous">
</script>

<script type="text/javascript">
$(function(){
    $('#gen-form').submit(function(e){
      e.preventDefault();
      $.ajax({
        type: "POST",
        url: "https://gpt2-hackernews-dstdu4u23a-uc.a.run.app",
        dataType: "json",
        data: JSON.stringify( {
            "prefix": $('#prefix').val(),
            "length": $('#gen-length').val(),
            "temperature": $('#temperature').val(),
            } ),
        beforeSend: function(data) {
          $('#generate-text').addClass("is-loading");
          $('#generate-text').prop("disabled", true);
        },
        success: function(data) {
            $('#generate-text').removeClass("is-loading");
            $('#generate-text').prop("disabled", false);
            $('#tutorial').remove();
            var html = '<div class=\"gen-box\">' + data.text + '</div>'
            $(html).appendTo('#model-output').hide().fadeIn("slow");
        },
        error: function(jqXHR, textStatus, errorThrown) {
            $('#generate-text').removeClass("is-loading");
            $('#generate-text').prop("disabled", false);
            $('#tutorial').remove();
            var html = '<div class="gen-box warning">Error! The generated text did not return successfully!</div>';
            $(html).appendTo('#model-output').hide().fadeIn("slow");
        }
      });
    });
    $('#clear-text').click(function(e){ 
      $('#model-output').text('')
    });
  });
</script>

</html>